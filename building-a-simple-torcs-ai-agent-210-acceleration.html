<!DOCTYPE html>
<html lang="en">
<head>
  <title>Building a Simple TORCS AI Agent (2/10): Acceleration | [GTs] godidier's techsite</title>
  <meta charset="utf-8">
<meta name="description" content="Generate the AI agent base code To start building our AI agent, we will use a tool called robotgen, to create the baseline code structure. robotgen is used as following: robotgen -n <name> -a <author> -c <car> [-d description] [--gpl] Where name is the name of the agent we are …"><meta name="author" content="Didier Gohourou">  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
  <meta http-equiv="Cache-Control" content="max-age=604800, must-revalidate" />
  <link href="/theme/css/screen.css" rel="stylesheet" type="text/css" />
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link href="/" type="application/atom+xml" rel="alternate" title="[GTs] godidier's techsite ATOM Feed" />

  <style>
  .tooltip { position: relative; display: inline-block; border-bottom: 1px dotted black; }
  .tooltip .tooltiptext { visibility: hidden; width: 120px; background-color: #555; color: #fff; text-align: center; border-radius: 6px; padding: 5px 0; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -60px; opacity: 0; transition: opacity 0.3s; }
  .tooltip .tooltiptext::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: #555 transparent transparent transparent; }
  .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
  </style>
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
  <div class="logo"><a href="">[GTs] godidier's techsite</a></div>
  <div class="small"></div>
    <div class="nav">
    </div>
    <div class="nav social">
<ul>
    <li><a href="#">You can add links in your config file</a></li>
    <li><a href="#">Another social link</a></li>
</ul>    </div>
</div>    <div id="main">
<h2><a href="/building-a-simple-torcs-ai-agent-210-acceleration.html">Building a Simple TORCS AI Agent (2/10): Acceleration</a></h2>
<h5><i class="icon-feather"></i> 土 08 12月 2018
<i class="icon-bookmarks"></i>
</h5>

<h1>Generate the AI agent base code</h1>
<p>To start building our AI agent, we will use a tool called <code>robotgen</code>, to create 
the baseline code structure. robotgen is used as following: </p>
<div class="highlight"><pre><span></span>robotgen -n &lt;name&gt; -a &lt;author&gt; -c &lt;car&gt; [-d description] [--gpl]
</pre></div>


<p>Where <code>name</code> is the name of the agent we are creating, <code>author</code> is the name of the 
creator (AKA you) and <code>car</code> is the name of the car we want our agent to be using. 
We might also use optional argument to give a description of our agent, or add a 
GPL statement at the beginning of the source code files.</p>
<p>The list of available cars and be obtain as follow:</p>
<div class="highlight"><pre><span></span>$ ls /usr/local/share/games/torcs/cars/ 
<span class="m">155</span>-DTM car2-trb1 kc-a110 kc-dbs pw-206wrc 
acura-nsx-sz car3-trb1 kc-alfatz2 kc-dino pw-306wrc 
baja-bug car4-trb1 kc-bigh kc-ghibli pw-corollawrc 
buggy car5-trb1 kc-cobra kc-giulietta pw-evoviwrc 
car1-ow1 car6-trb1 kc-coda kc-grifo pw-focuswrc 
car1-stock1 car7-trb1 kc-conrero kc-gt40 pw-imprezawrc 
car1-stock2 car8-trb1 kc-corvette-ttop kc-gto 
car1-trb1 kc-2000gt kc-daytona kc-p4 
car1-trb3 kc-5300gt kc-db4z p406
</pre></div>


<p>Now let's move to the <code>$TOCS_BASE</code> folder, and use the robotgen utility is and 
generate the initial source code of our agent.</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$TORCS_BASE</span> 
$ ./robotgen -n <span class="s2">&quot;gts&quot;</span> -a <span class="s2">&quot;Godidier TechSite&quot;</span> -c <span class="s2">&quot;car1-trb1&quot;</span>
</pre></div>


<p>This command will create a folder with the name of your ai agent inside 
<code>$TORCS_BASE/src/drivers</code>. Inside that folder (in our case 
<code>$TORCS_BASE/src/drivers/na</code>), we will have the following files:</p>
<ul>
<li><strong>Makefile</strong> : Instruction for compiling and installing your AI agent</li>
<li><strong>gts.cpp</strong> : Actual code of your AI agent</li>
<li><strong>gts.xml</strong> : Customizable properties for your agent</li>
<li><strong>gts.def</strong>, <strong>na.dsp</strong> : Some Visual Studio (2005) project files. 
Not much useful anymore</li>
<li><strong>car1-trb1.rbg</strong> : Image file used as paint job for the car</li>
<li><strong>logo.rbg</strong> : Image file used as paint job for your driver's name and flag 
and your team's logo</li>
<li><strong>car1-trb1.xcf</strong> : GIMP project file to edit your paint job's image files</li>
</ul>
<h1>Install the AI Agent</h1>
<p>build the code </p>
<p>Install  (start the game with the AI doing nothing)</p>
<p>How to uninstall </p>
<h1>Before We Write Some Code</h1>
<p>In this chapter of the series, we implement basic steering and acceleration. 
All in the AI agent main cpp file represented by <code>gts.cpp</code>. Let's check the 
content of the file.</p>
<p>Open the file with your favourite text editor, one with syntax highlighting should be enough. The file start with some standard C language header files. Then we have some TORCS header files that includes the necessary data structures and functions for the implementation of our agent. Note: those file are accessible via <code>$TORCS_BASE/export/include</code>.</p>
<ul>
<li>tgh.h : Generic gaming API utilities</li>
<li>track.h : Structure and loader of tracks</li>
<li>car.h : Data structure (and sub structure) representing a car</li>
<li>raceman.h : Data Structures providing information during a race</li>
<li>robottools.h : Utility functions to compute values useful to the AI agent (robot)</li>
<li>robot.h : AI agent (robot) module interface definition. Contains callback functions that operate the robot.</li>
</ul>
<p>After the headers come the declaration and definition of the function we will edit to build our AI agent.</p>
<p><code>initTrack</code>: Called for every track change. Can be used to deal with some 
initialization before a new race.</p>
<div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="nf">initTrack</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">tTrack</span><span class="o">*</span> <span class="n">track</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">carHandle</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">carParmHandle</span><span class="p">,</span> <span class="n">tSituation</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span> 
</pre></div>


<p><code>newrace</code>: Used as callback when a new race starts.</p>
<div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="nf">newrace</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">tCarElt</span><span class="o">*</span> <span class="n">car</span><span class="p">,</span> <span class="n">tSituation</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
</pre></div>


<p><code>drive</code>: Used as callback to get the driving instructions.</p>
<div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="nf">drive</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">tCarElt</span><span class="o">*</span> <span class="n">car</span><span class="p">,</span> <span class="n">tSituation</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
</pre></div>


<p><code>endrace</code>: Used as callback when the current race ends.</p>
<div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="nf">endrace</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">tCarElt</span> <span class="o">*</span><span class="n">car</span><span class="p">,</span> <span class="n">tSituation</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
</pre></div>


<p><code>shutdown</code>: Called before the module is unloaded. Can be used to free memory.</p>
<div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">);</span>
</pre></div>


<p><code>InitFuncPt</code>: Module interface initialization. Setup the implemented callback 
function that will operate the AI agent.</p>
<div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">InitFuncPt</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">pt</span><span class="p">);</span>
</pre></div>


<p><code>gts</code> (AI agent name): Module entry point. Used to initialize the AI agent 
module properties.</p>
<div class="highlight"><pre><span></span><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">int</span> <span class="n">na</span><span class="p">(</span><span class="n">tModInfo</span> <span class="o">*</span><span class="n">modInfo</span><span class="p">)</span> 
<span class="p">{</span> 
<span class="p">...</span> 
<span class="p">}</span>
</pre></div>


<h1>Let's drive</h1>
<p>To accelerate we just press the accelerator right ?!... We might as well end up in the grass or the wall a the first turn you encounter! So I think we might want some basic steering. For our first drive the plan is to accelerate slowly and steer in a way to always stay in the middle of the track. To avoid that, we will implement a basic steering mechanism to allow the car to stay in the middle of the track. My laziness sense tells me that it is time to quote the tutorial shipped with the game.</p>
<blockquote>
<p>Before we can start implementing simple steering we need to discuss how the track 
looks for the robot. The track is partitioned into segments of the following 
types: left turns, right turns and straight segments. The segments are usually 
short, so a turn that looks like a big turn or a long straight is most often 
split into much smaller segments. The segments are organized as linked list in 
the memory. A straight segment has a width and a length, a turn has a width, a 
length and a radius, everyting is measured in the middle of the track. 
All segments connect tangentially to the next and previous segments, so the 
middle line is smooth. There is much more data available, the structure 
tTrack is defined in $TORCS_BASE/export/include/track.h.</p>
</blockquote>
<p>The image below from <a href="https://en.wikipedia.org/wiki/Speed_Dreams#Tracks">Wikipedia</a> 
give an illustration of the quote above.</p>

<p align="center"><a href="#">on the top</a></p>
    </div>
</div>
<div id="footer-wrapper">
<ul class="footer">
</ul><ul class="footer">
    <li class="footer">&copy;&nbsp;2014&nbsp;::</li>
    <li class="footer"><a href="">[GTs] godidier's techsite </a>&nbsp;::</li>
    <li class="footer">powered by <a href="https://github.com/getpelican">pelican</a>&nbsp;::</li>
    <li class="footer"><a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru">CC BY-NC</a></li>
</ul>
</div></body>
</html>