title: Building a Simple TORCS AI Agent (2/10): Acceleration
date: 2018-12-08 15:21
category: Games
authors: Didier Gohourou
summary: Making the car accelerate slightly and steering basically.
slug: torcs-ai-2
lang: en

# Generate the AI agent base code

To start building our AI agent, we will use a tool called `robotgen`, to create 
the baseline code structure. robotgen is used as following: 

```
robotgen -n <name> -a <author> -c <car> [-d description] [--gpl]
```

Where `name` is the name of the agent we are creating, `author` is the name of the 
creator (AKA you) and `car` is the name of the car we want our agent to be using. 
We might also use optional argument to give a description of our agent, or add a 
GPL statement at the beginning of the source code files.

The list of available cars and be obtain as follow:

```
$ ls /usr/local/share/games/torcs/cars/ 
155-DTM car2-trb1 kc-a110 kc-dbs pw-206wrc 
acura-nsx-sz car3-trb1 kc-alfatz2 kc-dino pw-306wrc 
baja-bug car4-trb1 kc-bigh kc-ghibli pw-corollawrc 
buggy car5-trb1 kc-cobra kc-giulietta pw-evoviwrc 
car1-ow1 car6-trb1 kc-coda kc-grifo pw-focuswrc 
car1-stock1 car7-trb1 kc-conrero kc-gt40 pw-imprezawrc 
car1-stock2 car8-trb1 kc-corvette-ttop kc-gto 
car1-trb1 kc-2000gt kc-daytona kc-p4 
car1-trb3 kc-5300gt kc-db4z p406
```
Now let's move to the `$TOCS_BASE` folder, and use the robotgen utility is and 
generate the initial source code of our agent.

```
$ cd $TORCS_BASE 
$ ./robotgen -n "gts" -a "Godidier TechSite" -c "car1-trb1"
```

This command will create a folder with the name of your ai agent inside 
`$TORCS_BASE/src/drivers`. Inside that folder (in our case 
`$TORCS_BASE/src/drivers/na`), we will have the following files:

* **Makefile** : Instruction for compiling and installing your AI agent
* **gts.cpp** : Actual code of your AI agent
* **gts.xml** : Customizable properties for your agent
* **gts.def**, **na.dsp** : Some Visual Studio (2005) project files. 
Not much useful anymore
* **car1-trb1.rbg** : Image file used as paint job for the car
* **logo.rbg** : Image file used as paint job for your driver's name and flag 
and your team's logo
* **car1-trb1.xcf** : GIMP project file to edit your paint job's image files

# Install the AI Agent

build the code 

Install  (start the game with the AI doing nothing)

How to uninstall 

# Before We Write Some Code

In this chapter of the series, we implement basic steering and acceleration. 
All in the AI agent main cpp file represented by `gts.cpp`. Let's check the 
content of the file.

Open the file with your favourite text editor, one with syntax highlighting should be enough. The file start with some standard C language header files. Then we have some TORCS header files that includes the necessary data structures and functions for the implementation of our agent. Note: those file are accessible via ` $TORCS_BASE/export/include`.

* tgh.h : Generic gaming API utilities
* track.h : Structure and loader of tracks
* car.h : Data structure (and sub structure) representing a car
* raceman.h : Data Structures providing information during a race
* robottools.h : Utility functions to compute values useful to the AI agent (robot)
* robot.h : AI agent (robot) module interface definition. Contains callback functions that operate the robot.

After the headers come the declaration and definition of the function we will edit to build our AI agent.

`initTrack`: Called for every track change. Can be used to deal with some 
initialization before a new race.
```C
static void initTrack(int index, tTrack* track, void *carHandle, void **carParmHandle, tSituation *s); 
```

`newrace`: Used as callback when a new race starts.
```C
static void newrace(int index, tCarElt* car, tSituation *s);
```

`drive`: Used as callback to get the driving instructions.
```C
static void drive(int index, tCarElt* car, tSituation *s);
```

`endrace`: Used as callback when the current race ends.
```C
static void endrace(int index, tCarElt *car, tSituation *s);
```

`shutdown`: Called before the module is unloaded. Can be used to free memory.
```C
static void shutdown(int index);
```

`InitFuncPt`: Module interface initialization. Setup the implemented callback 
function that will operate the AI agent.
```C
static int InitFuncPt(int index, void *pt);
```

`gts` (AI agent name): Module entry point. Used to initialize the AI agent 
module properties.
```C
extern "C" int na(tModInfo *modInfo) 
{ 
... 
}
```

# Let's drive

To accelerate we just press the accelerator right ?!... We might as well end up in 
the grass or the wall a the first turn you encounter! So I think we might want 
some basic steering. For our first drive the plan is to accelerate slowly and 
steer in a way to always stay in the middle of the track. My laziness sense tells 
me that it is time to quote the tutorial shipped with the game.

> Before we can start implementing simple steering we need to discuss how the track 
> looks for the robot. The track is partitioned into segments of the following 
> types: left turns, right turns and straight segments. The segments are usually 
> short, so a turn that looks like a big turn or a long straight is most often 
> split into much smaller segments. The segments are organized as linked list in 
> the memory. A straight segment has a width and a length, a turn has a width, a 
> length and a radius, everyting is measured in the middle of the track. 
> All segments connect tangentially to the next and previous segments, so the 
> middle line is smooth. There is much more data available, the structure 
> tTrack is defined in $TORCS_BASE/export/include/track.h.

The image below from [Wikipedia](https://en.wikipedia.org/wiki/Speed_Dreams#Tracks)
give an illustration of the quote above.

![Track Segment section]({static}/images/2018-12/Speed_Dreams_Track_Subsegments-Sections_animation.gif)

What if I don't add the correction 'to the Middle'
